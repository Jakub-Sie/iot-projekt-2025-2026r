#include <Arduino.h>
#include <Wire.h>
#include <INA226_WE.h>

// Domyślny adres dla większości modułów to 0x40
#define I2C_ADDRESS 0x40

INA226_WE ina226 = INA226_WE(I2C_ADDRESS);

void setup() {
    Serial.begin(115200);
    while (!Serial); 

    Wire.begin(21, 22);

    Serial.println("Inicjalizacja INA226...");

    if (!ina226.init()) {
        Serial.println("BŁĄD: Nie znaleziono modułu!");
        while (1);
    }

    // Poprawiona linia dla wersji biblioteki 1.3.0
    ina226.setResistorRange(0.1, 2.0);
    ina226.setAverage(INA226_AVERAGE_16); // Zmieniono z AVERAGE_16

    Serial.println("INA226 gotowy.");
}

void loop() {
    float busVoltage_V = 0.0;
    float current_mA = 0.0;
    float power_mW = 0.0;
    float shuntVoltage_mV = 0.0;

    // Odczyt danych
    busVoltage_V = ina226.getBusVoltage_V();
    current_mA = ina226.getCurrent_mA();
    power_mW = ina226.getBusPower(); // W tej bibliotece to zwraca mW
    shuntVoltage_mV = ina226.getShuntVoltage_mV();

    // Wyświetlanie wyników w Monitorze Szeregowym
    Serial.print("Napięcie: "); Serial.print(busVoltage_V); Serial.println(" V");
    Serial.print("Prąd:     "); Serial.print(current_mA); Serial.println(" mA");
    Serial.print("Moc:      "); Serial.print(power_mW);    Serial.println(" mW");
    Serial.println("------------------------------------");

    delay(1000);
}